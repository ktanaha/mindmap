# OYUWAKU - 機能一覧

Markdown駆動型マインドマップアプリケーション

## 目次
- [概要](#概要)
- [基本機能](#基本機能)
- [マインドマップ機能](#マインドマップ機能)
- [エディタ機能](#エディタ機能)
- [ドラッグ&ドロップ機能](#ドラッグドロップ機能)
- [UI/UX機能](#uiux機能)
- [ファイル管理機能](#ファイル管理機能)
- [表示設定機能](#表示設定機能)
- [エクスポート機能](#エクスポート機能)

---

## 概要

**OYUWAKU**は、Markdownテキストとマインドマップをリアルタイムに同期する、直感的な思考整理ツールです。

### 主な特徴
- **Markdown駆動**: テキストエディタでMarkdownを編集すると、即座にマインドマップに反映
- **双方向編集**: マインドマップ上でノードをドラッグ&ドロップして構造を変更すると、Markdownも更新
- **リアルタイム同期**: エディタとマインドマップが常に同期

---

## 基本機能

### アプリケーション構成
- **2ペイン構造**
  - 左ペイン: Markdownエディタ
  - 右ペイン: マインドマップビュー
  - スプリッターで幅を自由に調整可能（設定は自動保存）

### ファイル操作
- 新規作成 (`Ctrl+N`)
- ファイルを開く (`Ctrl+O`)
- 保存 (`Ctrl+S`)
- 名前を付けて保存 (`Ctrl+Shift+S`)
- 自動保存機能（5秒間操作がない場合に自動保存）

---

## マインドマップ機能

### レイアウトモード
1. **右のみモード**: ルートノードから右方向のみに展開
2. **左右交互モード**: ルートノードから左右対称に展開
3. **下のみモード**: ルートノードから下方向のみに展開
4. **上下交互モード**: ルートノードから上下対称に展開

### ノード表示
- **階層構造の可視化**: インデントレベルに応じた階層表示
- **ベジェ曲線による接続**: 親子ノード間を滑らかな曲線で接続
- **カスタマイズ可能なスタイル**:
  - フォントサイズ（ノード単位、サブツリー単位、全体）
  - フォント色（ノード単位、サブツリー単位、全体）
  - 線の色（全体）

### ノード選択とフォーカス
- **選択状態**: ノードクリックで青い枠線と薄い背景で表示
- **フォーカス状態**: エディタのカーソル位置に対応するノードを薄い赤枠で表示
- **スムーズアニメーション**: ノード選択時に画面が滑らかに移動（500ミリ秒）

### ズーム・パン操作
- **マウスホイールズーム**: マウスホイールで拡大・縮小
- **トラックパッドピンチジェスチャー**: 2本指でピンチイン/アウト
- **2本指ドラッグでパン**: トラックパッドで画面移動

---

## エディタ機能

### Markdown編集
- **リアルタイムパース**: テキスト変更を即座にマインドマップに反映
- **階層構造の認識**: インデント（タブまたはスペース）で階層を判定
- **シンタックスハイライト**: 見やすいMarkdown編集

### カーソル連動
- **エディタ→マインドマップ**: カーソル移動で対応ノードにフォーカス＆中心表示
- **マインドマップ→エディタ**: ノードクリックでエディタのカーソルが該当行に移動

---

## ドラッグ&ドロップ機能

### ノードの付け替え
- **直感的な操作**: ノードを他のノードにドラッグ&ドロップして親子関係を変更
- **ゴーストアイテム**: ドラッグ中は半透明のゴーストがカーソルに追従
- **ハイライト表示**: ドロップ先候補のノードをオレンジ色でハイライト
- **バリデーション**: 自分自身の子孫ノードには付け替え不可

### ドラッグ動作の最適化
- **元の位置に戻る**: ドロップ先がない場合、ノードは元の位置に自動復帰
- **接続線の残像防止**: ドラッグ中はノード本体を動かさず、ゴーストのみ移動
- **ドロップ後の中心表示**: ドロップ先のノード（新しい親）が画面中央にアニメーション表示

### Markdown自動更新
- ドラッグ&ドロップでノード構造を変更すると、Markdownテキストが自動的に更新される
- ツリー構造が正しく保たれる

---

## UI/UX機能

### スムーズアニメーション
- **画面移動アニメーション**: ノード選択時に500ミリ秒かけて滑らかに移動
- **イージングカーブ**: InOutCubicで自然な加速・減速
- **視認性の向上**: 移動の軌跡が見えるため、どこに移動したか分かりやすい

### 通知システム
- **自動保存通知**: 右下に青い通知ポップアップ表示
- **フェードアウト**: 2.5秒後に自動的に非表示
- **リサイズ対応**: ウィンドウサイズ変更時も位置を調整

### ビジュアルフィードバック
- **選択状態**: 青い枠線と薄い背景
- **フォーカス状態**: 薄い赤枠とグレー背景
- **ドラッグ中**: 半透明化とオレンジ色の枠線
- **ドロップ先候補**: オレンジ色のハイライト

---

## ファイル管理機能

### 最近開いたファイル
- **履歴管理**: 最大10件の最近開いたファイルを記録
- **メニューアクセス**: 「ファイル」→「最近開いたファイル」から選択
- **存在確認**: 削除されたファイルは自動的にリストから除外
- **永続化**: ホームディレクトリに`.oyuwaku_recent_files.txt`として保存

### ファイル操作ログ
- **操作記録**: ファイルの「開く」「保存」操作をタイムスタンプ付きで記録
- **最大10件保持**: 古いログは自動的に削除
- **ログファイル**: ホームディレクトリに`.oyuwaku_file_history.log`として保存

### 未保存変更の検出
- **変更検出**: テキスト編集時に未保存フラグを設定
- **確認ダイアログ**: ファイルを閉じる/開く/新規作成時に保存確認
- **オプション**: 保存/保存せずに続行/キャンセル

---

## 表示設定機能

### フォント設定
- **フォントサイズ**: 10〜72ポイント
- **フォント色**: カラーピッカーで自由に選択
- **適用範囲**:
  - 全体に適用
  - 選択中のノードのみ
  - 選択中のノード以下すべて

### 線の設定
- **線の色**: カラーピッカーで自由に選択（全体に適用）

### レイアウト設定
- **4つのレイアウト方向**: 右のみ、左右交互、下のみ、上下交互
- **ペイン配置**: 左右配置または上下配置

### 設定の保存
- すべての設定はQSettingsで永続化
- 次回起動時に設定を復元

---

## エクスポート機能

### PNG形式でエクスポート
- マインドマップ全体をPNG画像として保存
- 余白を含めた適切なサイズで出力
- メニュー: 「ファイル」→「PNG形式でエクスポート」

---

## 技術仕様

### アーキテクチャ
- **フレームワーク**: PyQt6
- **デザインパターン**: クリーンアーキテクチャ
- **レイヤー構成**:
  - `domain`: ドメインモデル（Node, MindMap）
  - `presentation`: プレゼンテーション層（UI）
  - `parser`: Markdownパーサー・コンバーター
  - `storage`: ストレージ層（将来の拡張用）

### 主要コンポーネント
- **MainWindow**: メインウィンドウとアプリケーションロジック
- **MarkdownEditor**: Markdownエディタ（左ペイン）
- **MindMapView**: マインドマップビュー（右ペイン）
- **NodeItem**: ドラッグ可能なノードアイテム
- **MarkdownParser**: Markdownテキストをノードツリーに変換
- **TreeToMarkdownConverter**: ノードツリーをMarkdownテキストに変換

### 動作環境
- **Python**: 3.13以降
- **OS**: macOS, Windows, Linux
- **依存ライブラリ**: PyQt6

---

## バージョン情報

**現在のバージョン**: 開発中

### 最近の主な修正・改善
- ノード選択時のスムーズアニメーション実装
- ドラッグ&ドロップ後の再描画バグ修正
- 接続線の残像問題修正
- ノードクリック時のフォーカス問題修正
- 最近開いたファイル読み込みエラー修正
- 手動配置ノードのUnboundLocalError修正

---

## ライセンス

（プロジェクトのライセンスを記載）
